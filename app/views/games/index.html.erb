<% content_for :importmap_tag do %>
    <%= javascript_importmap_tags 'game/index' %>
<% end %>

<h1>Games</h1>

<div class="mb-3">
  <%= form_with url: games_path, method: :get, local: true, class: "d-flex gap-2" do |form| %>
    <%= form.text_field :search, 
        placeholder: "プレーヤー名で検索", 
        value: @search,
        class: "form-control",
        style: "max-width: 200px;" %>
    <%= form.hidden_field :page, value: 1 %>
    <%= form.submit "検索", class: "btn btn-primary" %>
    <% if @search.present? %>
      <%= link_to "クリア", games_path, class: "btn btn-outline-secondary" %>
    <% end %>
  <% end %>
</div>

<%= render "table", games: @games %>

<% if @total_pages > 1 %>
  <div class="mt-3">
    <nav aria-label="Page navigation">
      <ul class="pagination">
        <% if @page > 1 %>
          <li class="page-item">
            <%= link_to "Previous", games_path(page: @page - 1, search: @search), class: "page-link" %>
          </li>
        <% else %>
          <li class="page-item disabled">
            <span class="page-link">Previous</span>
          </li>
        <% end %>

        <% (1..@total_pages).each do |page_num| %>
          <% if page_num == @page %>
            <li class="page-item active">
              <span class="page-link"><%= page_num %></span>
            </li>
          <% else %>
            <li class="page-item">
              <%= link_to page_num, games_path(page: page_num, search: @search), class: "page-link" %>
            </li>
          <% end %>
        <% end %>

        <% if @page < @total_pages %>
          <li class="page-item">
            <%= link_to "Next", games_path(page: @page + 1, search: @search), class: "page-link" %>
          </li>
        <% else %>
          <li class="page-item disabled">
            <span class="page-link">Next</span>
          </li>
        <% end %>
      </ul>
    </nav>
  </div>
<% end %>

<% if logged_in? %>
<%= link_to "New game", new_game_path %>
<% end %>
